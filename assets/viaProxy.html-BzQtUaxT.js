import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as a,o as t,c as r,a as e,b as n,d as i,e as p}from"./app-CLrSjQGd.js";const c={},l=e("h1",{id:"配置docker使用代理服务器",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#配置docker使用代理服务器"},[e("span",null,"配置Docker使用代理服务器")])],-1),d=e("blockquote",null,[e("p",null,"Configure the Docker daemon to use a proxy server")],-1),m={href:"https://docs.docker.com/config/daemon/systemd/#httphttps-proxy",target:"_blank",rel:"noopener noreferrer"},u=p(`<p>The Docker daemon uses the following environment variables in its start-up environment to configure HTTP or HTTPS proxy behavior:</p><blockquote><p>HTTP_PROXY<br> http_proxy<br> HTTPS_PROXY<br> https_proxy<br> NO_PROXY<br> no_proxy</p></blockquote><p>In Docker Engine version 23.0 and later versions, you may also configure proxy behavior for the daemon in the daemon.json file:</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;proxies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;http-proxy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://proxy.example.com:3128&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;https-proxy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://proxy.example.com:3129&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;no-proxy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*.test.example.com,.example.org,127.0.0.0/8&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>These configurations override the default docker.service systemd file.</p><p>If you&#39;re behind an HTTP or HTTPS proxy server, for example in corporate settings, the daemon proxy configurations must be specified in the systemd service file, not in the daemon.json file or using environment variables.</p><p>Note for rootless mode</p><p>The location of systemd configuration files are different when running Docker in rootless mode. When running in rootless mode, Docker is started as a user-mode systemd service, and uses files stored in each users&#39; home directory in ~/.config/systemd/user/docker.service.d/. In addition, systemctl must be executed without sudo and with the --user flag. Select the &quot;rootless mode&quot; tab below if you are running Docker in rootless mode.</p><p>regular install rootless mode Create a systemd drop-in directory for the docker service:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code> <span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/systemd/system/docker.service.d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Create a file named /etc/systemd/system/docker.service.d/http-proxy.conf that adds the HTTP_PROXY environment variable:</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
Environment=<span class="token string">&quot;HTTP_PROXY=http://proxy.example.com:3128&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>If you are behind an HTTPS proxy server, set the HTTPS_PROXY environment variable:</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
Environment=<span class="token string">&quot;HTTPS_PROXY=https://proxy.example.com:3129&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Multiple environment variables can be set; to set both a non-HTTPS and a HTTPs proxy;</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
Environment=<span class="token string">&quot;HTTP_PROXY=http://proxy.example.com:3128&quot;</span>
Environment=<span class="token string">&quot;HTTPS_PROXY=https://proxy.example.com:3129&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container note"><p class="hint-container-title">Note</p><p>Special characters in the proxy value, such as #?!()[]{}, must be double escaped using %%. For example:</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
Environment=<span class="token string">&quot;HTTP_PROXY=http://domain%%5Cuser:complex%%23pass@proxy.example.com:3128/&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><p>If you have internal Docker registries that you need to contact without proxying, you can specify them via the NO_PROXY environment variable.</p><p>The NO_PROXY variable specifies a string that contains comma-separated values for hosts that should be excluded from proxying. These are the options you can specify to exclude hosts:</p><p>IP address prefix (1.2.3.4) Domain name, or a special DNS label (<em>) A domain name matches that name and all subdomains. A domain name with a leading &quot;.&quot; matches subdomains only. For example, given the domains foo.example.com and example.com: example.com matches example.com and foo.example.com, and .example.com matches only foo.example.com A single asterisk (</em>) indicates that no proxying should be done Literal port numbers are accepted by IP address prefixes (1.2.3.4:80) and domain names (foo.example.com:80) Example:</p><p>[Service] Environment=&quot;HTTP_PROXY=http://proxy.example.com:3128&quot; Environment=&quot;HTTPS_PROXY=https://proxy.example.com:3129&quot; Environment=&quot;NO_PROXY=localhost,127.0.0.1,docker-registry.example.com,.corp&quot; Flush changes and restart Docker</p><p>sudo systemctl daemon-reload sudo systemctl restart docker Verify that the configuration has been loaded and matches the changes you made, for example:</p><p>sudo systemctl show --property=Environment docker</p><p>Environment=HTTP_PROXY=http://proxy.example.com:3128 HTTPS_PROXY=https://proxy.example.com:3129 NO_PROXY=localhost,127.0.0.1,docker-registry.example.com,.corp</p>`,24);function h(v,x){const o=a("ExternalLinkIcon");return t(),r("div",null,[l,d,e("p",null,[n("官方链接："),e("a",m,[n("https://docs.docker.com/config/daemon/systemd/#httphttps-proxy"),i(o)])]),u])}const k=s(c,[["render",h],["__file","viaProxy.html.vue"]]),b=JSON.parse('{"path":"/tools/Docker/viaProxy.html","title":"配置Docker使用代理服务器","lang":"zh-CN","frontmatter":{"icon":"docker","author":"小苹果儿","date":"2024-04-01T00:00:00.000Z","category":["Docker"],"tag":["docker","容器"]},"headers":[],"git":{"createdTime":1713167647000,"updatedTime":1713167647000,"contributors":[{"name":"00D2","email":"shijinguosjg@gmail.com","commits":1}]},"readingTime":{"minutes":1.76,"words":529},"filePathRelative":"tools/Docker/viaProxy.md","localizedDate":"2024年4月1日","excerpt":"\\n<blockquote>\\n<p>Configure the Docker daemon to use a proxy server</p>\\n</blockquote>\\n<p>官方链接：<a href=\\"https://docs.docker.com/config/daemon/systemd/#httphttps-proxy\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://docs.docker.com/config/daemon/systemd/#httphttps-proxy</a></p>\\n<p>The Docker daemon uses the following environment variables in its start-up environment to configure HTTP or HTTPS proxy behavior:</p>"}');export{k as comp,b as data};
