<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.46" />
    <meta name="theme" content="VuePress Theme Hope" />
    <link rel="stylesheet" href="//at.alicdn.com/t/font_2410206_mfj6e1vbwo.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_3419447_0by4ppd578jl.css"><title>一文掌握 Ansible 自动化运维 | 紫苹果乐园</title><meta name="description" content="学习、记录、分享，知识无尽头">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.fcfb9715.css">
    <link rel="modulepreload" href="/assets/app.78d595fb.js"><link rel="modulepreload" href="/assets/一文掌握 Ansible 自动化运维.html.969c9895.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/一文掌握 Ansible 自动化运维.html.ace40b76.js"><link rel="prefetch" href="/assets/index.html.d6c60e80.js"><link rel="prefetch" href="/assets/slide.html.4d6fec68.js"><link rel="prefetch" href="/assets/index.html.4caa2028.js"><link rel="prefetch" href="/assets/update.html.ca1cd5bd.js"><link rel="prefetch" href="/assets/index.html.2daca8de.js"><link rel="prefetch" href="/assets/index.html.5b57e005.js"><link rel="prefetch" href="/assets/index.html.5f60407b.js"><link rel="prefetch" href="/assets/index.html.504458fa.js"><link rel="prefetch" href="/assets/Http头部HOST为空Nginx返回400错误.html.3ddda8a6.js"><link rel="prefetch" href="/assets/index.html.4823335b.js"><link rel="prefetch" href="/assets/f5限制部分源IP访问VS.html.cc5f3f47.js"><link rel="prefetch" href="/assets/index.html.f82ba5cc.js"><link rel="prefetch" href="/assets/浏览器DNS缓存.html.6e094b16.js"><link rel="prefetch" href="/assets/DNF.html.62df9291.js"><link rel="prefetch" href="/assets/index.html.dddf6826.js"><link rel="prefetch" href="/assets/Shell命令.html.76b0fcc6.js"><link rel="prefetch" href="/assets/YUM.html.71f01a6f.js"><link rel="prefetch" href="/assets/archive.html.1b5db2e8.js"><link rel="prefetch" href="/assets/filePermissions.html.9ce4704e.js"><link rel="prefetch" href="/assets/fileSearch.html.137c114e.js"><link rel="prefetch" href="/assets/fileSystem.html.15bab7ed.js"><link rel="prefetch" href="/assets/fileTypes.html.43015ea0.js"><link rel="prefetch" href="/assets/nic.html.bde8d687.js"><link rel="prefetch" href="/assets/vim.html.5b4d23d0.js"><link rel="prefetch" href="/assets/免密登录.html.e62b16a0.js"><link rel="prefetch" href="/assets/重置root密码.html.203caa32.js"><link rel="prefetch" href="/assets/index.html.7da1b069.js"><link rel="prefetch" href="/assets/Windows10本地硬盘变成了可弹出磁盘.html.a2c4b77b.js"><link rel="prefetch" href="/assets/23款DevOps工具建设云原生时代.html.8a4b2399.js"><link rel="prefetch" href="/assets/index.html.2737e1ff.js"><link rel="prefetch" href="/assets/shell.html.08736628.js"><link rel="prefetch" href="/assets/index.html.25f5e946.js"><link rel="prefetch" href="/assets/Traefik使用教程.html.761ad05b.js"><link rel="prefetch" href="/assets/awesomeDocker.html.8bf1aa4d.js"><link rel="prefetch" href="/assets/index.html.a0605dcc.js"><link rel="prefetch" href="/assets/git_cmd中文乱码.html.fced66ee.js"><link rel="prefetch" href="/assets/git上传文件.html.fb4d943a.js"><link rel="prefetch" href="/assets/git修改远程仓库.html.5325b417.js"><link rel="prefetch" href="/assets/git报ssl错误解决方法.html.642f53a1.js"><link rel="prefetch" href="/assets/git的配置文件.html.91b7a3d4.js"><link rel="prefetch" href="/assets/index.html.ff573d88.js"><link rel="prefetch" href="/assets/index.html.6f96b36b.js"><link rel="prefetch" href="/assets/index.html.ae4c640a.js"><link rel="prefetch" href="/assets/index.html.879a2e0f.js"><link rel="prefetch" href="/assets/vPC_Sticky_Master.html.5be394fb.js"><link rel="prefetch" href="/assets/vpcAutoRecoveryConfiguration.html.e354c34c.js"><link rel="prefetch" href="/assets/404.html.a8e3cb07.js"><link rel="prefetch" href="/assets/index.html.e845cdce.js"><link rel="prefetch" href="/assets/index.html.ff7ccc29.js"><link rel="prefetch" href="/assets/index.html.d4953529.js"><link rel="prefetch" href="/assets/index.html.fb619bb8.js"><link rel="prefetch" href="/assets/index.html.55b4865a.js"><link rel="prefetch" href="/assets/index.html.05f66ce3.js"><link rel="prefetch" href="/assets/index.html.436433ee.js"><link rel="prefetch" href="/assets/index.html.b3549663.js"><link rel="prefetch" href="/assets/index.html.923de60b.js"><link rel="prefetch" href="/assets/index.html.67e60b8a.js"><link rel="prefetch" href="/assets/index.html.97954122.js"><link rel="prefetch" href="/assets/index.html.924fe3bc.js"><link rel="prefetch" href="/assets/index.html.b1903044.js"><link rel="prefetch" href="/assets/index.html.30337083.js"><link rel="prefetch" href="/assets/index.html.0cf48371.js"><link rel="prefetch" href="/assets/index.html.662bcbd6.js"><link rel="prefetch" href="/assets/index.html.93a2ba87.js"><link rel="prefetch" href="/assets/index.html.68f3a1ab.js"><link rel="prefetch" href="/assets/index.html.719d7c34.js"><link rel="prefetch" href="/assets/index.html.908b0b15.js"><link rel="prefetch" href="/assets/index.html.b366e1c7.js"><link rel="prefetch" href="/assets/index.html.1a961825.js"><link rel="prefetch" href="/assets/index.html.ccd98141.js"><link rel="prefetch" href="/assets/index.html.619e5062.js"><link rel="prefetch" href="/assets/index.html.09dbe7cb.js"><link rel="prefetch" href="/assets/index.html.b0d13102.js"><link rel="prefetch" href="/assets/index.html.35a96a76.js"><link rel="prefetch" href="/assets/index.html.ee067478.js"><link rel="prefetch" href="/assets/index.html.330c211c.js"><link rel="prefetch" href="/assets/index.html.fa8a0715.js"><link rel="prefetch" href="/assets/index.html.ff880da4.js"><link rel="prefetch" href="/assets/index.html.76b688e8.js"><link rel="prefetch" href="/assets/index.html.aa049d43.js"><link rel="prefetch" href="/assets/index.html.976ac1aa.js"><link rel="prefetch" href="/assets/index.html.1a10461f.js"><link rel="prefetch" href="/assets/index.html.7a409c0e.js"><link rel="prefetch" href="/assets/index.html.69970203.js"><link rel="prefetch" href="/assets/index.html.e4e4b5e4.js"><link rel="prefetch" href="/assets/index.html.386b1b02.js"><link rel="prefetch" href="/assets/index.html.c5c5142d.js"><link rel="prefetch" href="/assets/index.html.891a56c5.js"><link rel="prefetch" href="/assets/index.html.f6dd81ea.js"><link rel="prefetch" href="/assets/index.html.281b9c9b.js"><link rel="prefetch" href="/assets/index.html.2eaa143a.js"><link rel="prefetch" href="/assets/index.html.a39e22da.js"><link rel="prefetch" href="/assets/index.html.8c93f9d7.js"><link rel="prefetch" href="/assets/index.html.31489283.js"><link rel="prefetch" href="/assets/index.html.85d09efb.js"><link rel="prefetch" href="/assets/index.html.52ba8291.js"><link rel="prefetch" href="/assets/index.html.d57e4a23.js"><link rel="prefetch" href="/assets/index.html.7ab85a09.js"><link rel="prefetch" href="/assets/index.html.8c15102c.js"><link rel="prefetch" href="/assets/index.html.86f23902.js"><link rel="prefetch" href="/assets/index.html.8d41c362.js"><link rel="prefetch" href="/assets/index.html.ded00b36.js"><link rel="prefetch" href="/assets/index.html.182cdf59.js"><link rel="prefetch" href="/assets/index.html.afbe7a4f.js"><link rel="prefetch" href="/assets/slide.html.214646a1.js"><link rel="prefetch" href="/assets/index.html.743672c7.js"><link rel="prefetch" href="/assets/update.html.bcbdaba5.js"><link rel="prefetch" href="/assets/index.html.d38a1c48.js"><link rel="prefetch" href="/assets/index.html.5101690e.js"><link rel="prefetch" href="/assets/index.html.b96f1c56.js"><link rel="prefetch" href="/assets/index.html.6a197c55.js"><link rel="prefetch" href="/assets/Http头部HOST为空Nginx返回400错误.html.081785e0.js"><link rel="prefetch" href="/assets/index.html.2fff803c.js"><link rel="prefetch" href="/assets/f5限制部分源IP访问VS.html.2a40dc1c.js"><link rel="prefetch" href="/assets/index.html.b85697f3.js"><link rel="prefetch" href="/assets/浏览器DNS缓存.html.a9c61df7.js"><link rel="prefetch" href="/assets/DNF.html.08ab7fee.js"><link rel="prefetch" href="/assets/index.html.322d910e.js"><link rel="prefetch" href="/assets/Shell命令.html.92c46da0.js"><link rel="prefetch" href="/assets/YUM.html.92959e06.js"><link rel="prefetch" href="/assets/archive.html.b43ff161.js"><link rel="prefetch" href="/assets/filePermissions.html.e469b450.js"><link rel="prefetch" href="/assets/fileSearch.html.b0c4d80b.js"><link rel="prefetch" href="/assets/fileSystem.html.218a94e4.js"><link rel="prefetch" href="/assets/fileTypes.html.73b9e6ea.js"><link rel="prefetch" href="/assets/nic.html.e3d91ea3.js"><link rel="prefetch" href="/assets/vim.html.3777d417.js"><link rel="prefetch" href="/assets/免密登录.html.75197760.js"><link rel="prefetch" href="/assets/重置root密码.html.52cb5e17.js"><link rel="prefetch" href="/assets/index.html.16ee2b4d.js"><link rel="prefetch" href="/assets/Windows10本地硬盘变成了可弹出磁盘.html.e48f393d.js"><link rel="prefetch" href="/assets/23款DevOps工具建设云原生时代.html.73a5c9a4.js"><link rel="prefetch" href="/assets/index.html.c49c9444.js"><link rel="prefetch" href="/assets/shell.html.d04aa3e8.js"><link rel="prefetch" href="/assets/index.html.58e7e447.js"><link rel="prefetch" href="/assets/Traefik使用教程.html.5bc3857d.js"><link rel="prefetch" href="/assets/awesomeDocker.html.7493de1f.js"><link rel="prefetch" href="/assets/index.html.6ce309d4.js"><link rel="prefetch" href="/assets/git_cmd中文乱码.html.013bd420.js"><link rel="prefetch" href="/assets/git上传文件.html.a417650f.js"><link rel="prefetch" href="/assets/git修改远程仓库.html.e3292181.js"><link rel="prefetch" href="/assets/git报ssl错误解决方法.html.a6f5fc2e.js"><link rel="prefetch" href="/assets/git的配置文件.html.89d3baed.js"><link rel="prefetch" href="/assets/index.html.edffdeec.js"><link rel="prefetch" href="/assets/index.html.699cd709.js"><link rel="prefetch" href="/assets/index.html.821c2fc3.js"><link rel="prefetch" href="/assets/index.html.8ffa0867.js"><link rel="prefetch" href="/assets/vPC_Sticky_Master.html.98c65374.js"><link rel="prefetch" href="/assets/vpcAutoRecoveryConfiguration.html.79c1349f.js"><link rel="prefetch" href="/assets/404.html.70877ae0.js"><link rel="prefetch" href="/assets/index.html.8a69cb2c.js"><link rel="prefetch" href="/assets/index.html.692bf682.js"><link rel="prefetch" href="/assets/index.html.4f0b8adb.js"><link rel="prefetch" href="/assets/index.html.5c910b4d.js"><link rel="prefetch" href="/assets/index.html.463ebfb1.js"><link rel="prefetch" href="/assets/index.html.03785693.js"><link rel="prefetch" href="/assets/index.html.070b5103.js"><link rel="prefetch" href="/assets/index.html.c9c33671.js"><link rel="prefetch" href="/assets/index.html.8579cf7f.js"><link rel="prefetch" href="/assets/index.html.65e3665e.js"><link rel="prefetch" href="/assets/index.html.909722ba.js"><link rel="prefetch" href="/assets/index.html.4aad3a30.js"><link rel="prefetch" href="/assets/index.html.a734fe26.js"><link rel="prefetch" href="/assets/index.html.c89d8212.js"><link rel="prefetch" href="/assets/index.html.0a9dc279.js"><link rel="prefetch" href="/assets/index.html.dd65ed5e.js"><link rel="prefetch" href="/assets/index.html.4a37ffb2.js"><link rel="prefetch" href="/assets/index.html.1b8e31dd.js"><link rel="prefetch" href="/assets/index.html.5a681705.js"><link rel="prefetch" href="/assets/index.html.e22a6130.js"><link rel="prefetch" href="/assets/index.html.bc805dbd.js"><link rel="prefetch" href="/assets/index.html.9d6dac85.js"><link rel="prefetch" href="/assets/index.html.94722dae.js"><link rel="prefetch" href="/assets/index.html.fcf2c5cb.js"><link rel="prefetch" href="/assets/index.html.38c3d60a.js"><link rel="prefetch" href="/assets/index.html.322a7d57.js"><link rel="prefetch" href="/assets/index.html.818ab413.js"><link rel="prefetch" href="/assets/index.html.3ba9d3e0.js"><link rel="prefetch" href="/assets/index.html.a6ec7b9c.js"><link rel="prefetch" href="/assets/index.html.542ae096.js"><link rel="prefetch" href="/assets/index.html.f897bea3.js"><link rel="prefetch" href="/assets/index.html.08c3eac2.js"><link rel="prefetch" href="/assets/index.html.e09b41bf.js"><link rel="prefetch" href="/assets/index.html.111ccbb0.js"><link rel="prefetch" href="/assets/index.html.2b3437f8.js"><link rel="prefetch" href="/assets/index.html.05d3ed4c.js"><link rel="prefetch" href="/assets/index.html.d347814c.js"><link rel="prefetch" href="/assets/index.html.410181bb.js"><link rel="prefetch" href="/assets/index.html.036c939f.js"><link rel="prefetch" href="/assets/index.html.94233151.js"><link rel="prefetch" href="/assets/index.html.9d1f66ca.js"><link rel="prefetch" href="/assets/index.html.c5ced49d.js"><link rel="prefetch" href="/assets/index.html.15e0c5c8.js"><link rel="prefetch" href="/assets/index.html.6810b24f.js"><link rel="prefetch" href="/assets/index.html.1a034f87.js"><link rel="prefetch" href="/assets/index.html.56638fc0.js"><link rel="prefetch" href="/assets/index.html.6cd38512.js"><link rel="prefetch" href="/assets/index.html.1cbb7a15.js"><link rel="prefetch" href="/assets/index.html.d4ca28b2.js"><link rel="prefetch" href="/assets/index.html.3dce4ab0.js"><link rel="prefetch" href="/assets/index.html.7d889914.js"><link rel="prefetch" href="/assets/index.html.c59a9496.js"><link rel="prefetch" href="/assets/index.html.7130adaf.js"><link rel="prefetch" href="/assets/index.html.eceb5244.js"><link rel="prefetch" href="/assets/index.html.9b6eab31.js"><link rel="prefetch" href="/assets/index.html.d1e2364a.js"><link rel="prefetch" href="/assets/404.ff7dd54d.js"><link rel="prefetch" href="/assets/Layout.e30cd0b9.js"><link rel="prefetch" href="/assets/Blog.faed9dce.js"><link rel="prefetch" href="/assets/photoswipe.esm.2debdee5.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="紫苹果乐园"><!----><span class="site-name hide-in-pad">紫苹果乐园</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="主页"><span class="icon iconfont icon-home" style=""></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="操作系统"><span class="title"><span class="icon iconfont icon-OS" style=""></span>操作系统</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/os/linux/" class="nav-link" aria-label="Linux"><span class="icon iconfont icon-linux" style=""></span>Linux<!----></a></li><li class="dropdown-item"><a href="/os/windows/" class="nav-link" aria-label="Windows"><span class="icon iconfont icon-windows" style=""></span>Windows<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="网络技术"><span class="title"><span class="icon iconfont icon-network" style=""></span>网络技术</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/network/cisco/" class="nav-link" aria-label="Cisco"><span class="icon iconfont icon-cisco" style=""></span>Cisco<!----></a></li><li class="dropdown-item"><a href="/network/other/" class="nav-link" aria-label="其他"><span class="icon iconfont icon-other" style=""></span>其他<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="工具"><span class="title"><span class="icon iconfont icon-tool" style=""></span>工具</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/tools/Git/" class="nav-link" aria-label="Git"><span class="icon iconfont icon-git" style=""></span>Git<!----></a></li><li class="dropdown-item"><a href="/tools/Ansible/" class="nav-link active" aria-label="Ansible"><span class="icon iconfont icon-ansible" style=""></span>Ansible<!----></a></li><li class="dropdown-item"><a href="/tools/Travis%20CI/" class="nav-link" aria-label="Travis CI"><span class="icon iconfont icon-travisci" style=""></span>Travis CI<!----></a></li><li class="dropdown-item"><a href="/tools/Docker/" class="nav-link" aria-label="Docker"><span class="icon iconfont icon-docker" style=""></span>Docker<!----></a></li><li class="dropdown-item"><a href="/tools/K8S/" class="nav-link" aria-label="K8S"><span class="icon iconfont icon-kubernetes" style=""></span>K8S<!----></a></li><li class="dropdown-item"><a href="/tools/Vuepress/" class="nav-link" aria-label="Vuepress"><span class="icon iconfont icon-vue" style=""></span>Vuepress<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="索引"><span class="title"><span class="icon iconfont icon-tree" style=""></span>索引</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/Category" class="nav-link" aria-label="分类"><span class="icon iconfont icon-categoryselected" style=""></span>分类<!----></a></li><li class="dropdown-item"><a href="/Tag" class="nav-link" aria-label="标签"><span class="icon iconfont icon-tag" style=""></span>标签<!----></a></li><li class="dropdown-item"><a href="/Timeline" class="nav-link" aria-label="时间轴"><span class="icon iconfont icon-time" style=""></span>时间轴<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="强大的博客们"><span class="title"><span class="icon iconfont icon-blog" style=""></span>强大的博客们</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Mr.Hope</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://mrhope.site/" rel="noopener noreferrer" target="_blank" aria-label="博主主页" class="nav-link"><!---->博主主页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://vuepress-theme-hope.github.io/v2/zh/" rel="noopener noreferrer" target="_blank" aria-label="vuepress-theme-hope" class="nav-link"><!---->vuepress-theme-hope<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://mrhope.site/software/vscode/" rel="noopener noreferrer" target="_blank" aria-label="VS Code" class="nav-link"><!---->VS Code<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://mrhope.site/software/git/" rel="noopener noreferrer" target="_blank" aria-label="Git" class="nav-link"><!---->Git<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>vdoing</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://xugaoyi.com/" rel="noopener noreferrer" target="_blank" aria-label="博主主页" class="nav-link"><!---->博主主页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-subitem"><a href="https://xugaoyi.com/pages/beb6c0bd8a66cea6/#%E6%8E%A8%E8%8D%90" rel="noopener noreferrer" target="_blank" aria-label="好站收藏" class="nav-link"><!---->好站收藏<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></li><li class="dropdown-item"><a href="https://www.ruanyifeng.com/" rel="noopener noreferrer" target="_blank" aria-label="阮一峰的网络日志" class="nav-link"><span class="icon iconfont icon-hot" style=""></span>阮一峰的网络日志<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-item"><a href="https://www.linuxcool.com/" rel="noopener noreferrer" target="_blank" aria-label="Linux命令大全(手册)" class="nav-link"><span class="icon iconfont icon-shell" style=""></span>Linux命令大全(手册)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-item"><a href="https://conimi.com/" rel="noopener noreferrer" target="_blank" aria-label="Torrk&#39;s Blog" class="nav-link"><span class="icon iconfont icon-hot" style=""></span>Torrk&#39;s Blog<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/about/" class="nav-link" aria-label="关于"><span class="icon iconfont icon-about" style=""></span>关于<!----></a></div></nav><!----></div><div class="navbar-right"><!----><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://www.github.com/00D2/00d2.github.io" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div id="docsearch-container"></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/tools/Ansible/" class="nav-link sidebar-link sidebar-page" aria-label="Ansible"><span class="icon iconfont icon-ansible" style=""></span>Ansible<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->一文掌握 Ansible 自动化运维</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://www.jinguo.tk" target="_blank" rel="noopener noreferrer">小苹果儿</a></span><span property="author" content="小苹果儿"></span></span><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年6月5日</span><meta property="datePublished" content="2022-06-05T03:56:58.000Z"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_1一、基本部署" class="router-link-active router-link-exact-active toc-link level2">1一、基本部署</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#安装ansible" class="router-link-active router-link-exact-active toc-link level3">安装Ansible</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#ansible配置文件" class="router-link-active router-link-exact-active toc-link level3">Ansible配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#定义inventory" class="router-link-active router-link-exact-active toc-link level3">定义Inventory</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#使用秘钥方式连接" class="router-link-active router-link-exact-active toc-link level3">使用秘钥方式连接</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#使用帮助" class="router-link-active router-link-exact-active toc-link level3">使用帮助</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#ansible命令应用基础" class="router-link-active router-link-exact-active toc-link level3">Ansible命令应用基础</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_2二、常见模块" class="router-link-active router-link-exact-active toc-link level2">2二、常见模块</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_3三、ansible-playbook" class="router-link-active router-link-exact-active toc-link level2">3三、Ansible playbook</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_4四、yaml" class="router-link-active router-link-exact-active toc-link level2">4四、YAML</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_4-1-yaml介绍" class="router-link-active router-link-exact-active toc-link level3">4.1 YAML介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_4-2-yaml语法" class="router-link-active router-link-exact-active toc-link level3">4.2 YAML语法</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_4-2-1-list" class="router-link-active router-link-exact-active toc-link level3">4.2.1 list</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_4-2-2-dictionary" class="router-link-active router-link-exact-active toc-link level3">4.2.2 dictionary</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_5五、ansible基础元素" class="router-link-active router-link-exact-active toc-link level2">5五、Ansible基础元素</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_5-1-变量" class="router-link-active router-link-exact-active toc-link level3">5.1 变量</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_5-2-inventory" class="router-link-active router-link-exact-active toc-link level3">5.2 Inventory</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_5-3-条件测试" class="router-link-active router-link-exact-active toc-link level3">5.3 条件测试</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_5-4-迭代" class="router-link-active router-link-exact-active toc-link level3">5.4 迭代</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_6六、模板示例" class="router-link-active router-link-exact-active toc-link level2">6六、模板示例：</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_7七、ansible-playbooks" class="router-link-active router-link-exact-active toc-link level2">7七、Ansible playbooks</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_7-1-playbook基础组件" class="router-link-active router-link-exact-active toc-link level3">7.1 playbook基础组件</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_8八、roles" class="router-link-active router-link-exact-active toc-link level2">8八、roles</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_8-1-创建role的步骤" class="router-link-active router-link-exact-active toc-link level3">8.1 创建role的步骤</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_8-2-role内各目录中可应用的文件" class="router-link-active router-link-exact-active toc-link level3">8.2 role内各目录中可应用的文件</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/tools/Ansible/%E4%B8%80%E6%96%87%E6%8E%8C%E6%8F%A1%20Ansible%20%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4.html#_9九、tags" class="router-link-active router-link-exact-active toc-link level2">9九、Tags</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="一文掌握-ansible-自动化运维" tabindex="-1"><a class="header-anchor" href="#一文掌握-ansible-自动化运维" aria-hidden="true">#</a> 一文掌握 Ansible 自动化运维</h1><blockquote><p>作者: kangvcar</p></blockquote><blockquote><p>来源: https://my.oschina.net/kangvcar/blog/1830155</p></blockquote><h2 id="_1一、基本部署" tabindex="-1"><a class="header-anchor" href="#_1一、基本部署" aria-hidden="true">#</a> 1<strong>一、基本部署</strong></h2><h3 id="安装ansible" tabindex="-1"><a class="header-anchor" href="#安装ansible" aria-hidden="true">#</a> 安装Ansible</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># yum -y install epel-release
# yum list all *ansible*
# yum info ansible
# yum -y install ansible
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ansible配置文件" tabindex="-1"><a class="header-anchor" href="#ansible配置文件" aria-hidden="true">#</a> Ansible配置文件</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>/etc/ansible/ansible.cfg    主配置文件
/etc/ansible/hosts          Inventory
/usr/bin/ansible-doc        帮助文件
/usr/bin/ansible-playbook   指定运行任务文件
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="定义inventory" tabindex="-1"><a class="header-anchor" href="#定义inventory" aria-hidden="true">#</a> 定义Inventory</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># cd /etc/ansible/
# cp hosts{,.bak}
# &gt; hosts

# cat hosts
[webserver]
127.0.0.1
192.168.10.149

[dbserver]
192.168.10.113
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用秘钥方式连接" tabindex="-1"><a class="header-anchor" href="#使用秘钥方式连接" aria-hidden="true">#</a> 使用秘钥方式连接</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># ssh-keygen -t rsa 
# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.10.149
# ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.10.113
# ssh-copy-id -i /root/.ssh/id_rsa.pub root@127.0.0.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用帮助" tabindex="-1"><a class="header-anchor" href="#使用帮助" aria-hidden="true">#</a> 使用帮助</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># ansible-doc -l                列出ansible所有的模块
# ansible-doc -s MODULE_NAME    查看指定模块具体适用
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ansible命令应用基础" tabindex="-1"><a class="header-anchor" href="#ansible命令应用基础" aria-hidden="true">#</a> Ansible命令应用基础</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>语法：ansible &lt;host-pattern&gt; [-f forks] [-m module_name] [-a args]

&lt;host-pattern&gt;  这次命令对哪些主机生效的
   inventory group name
   ip
   all
-f forks        一次处理多少个主机
-m module_name  要使用的模块
-a args         模块特有的参数

# ansible 192.168.10.113 -m command -a &#39;date&#39;
# ansible webserver -m command -a &#39;date&#39;
# ansible all -m command -a &#39;date&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2二、常见模块" tabindex="-1"><a class="header-anchor" href="#_2二、常见模块" aria-hidden="true">#</a> 2<strong>二、常见模块</strong></h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>command     命令模块(默认模块)用于在远程主机执行命令；不能使用变量，管道等
# ansible all -a &#39;date&#39;
cron        计划任务    
   month   指定月份
   minute  指定分钟
   job     指定任务
   day     表示那一天
   hour    指定小时
   weekday 表示周几
   state   表示是添加还是删除
       present：安装
       absent：移除
   # ansible webserver -m cron -a &#39;minute=&quot;*/10&quot; job=&quot;/bin/echo hello&quot; name=&quot;test cron job&quot;&#39;   #不写默认都是*，每个任务都必须有一个名字 
   # ansible webserver -a &#39;crontab -l&#39;
   # ansible webserver -m cron -a &#39;minute=&quot;*/10&quot; job=&quot;/bin/echo hello&quot; name=&quot;test cron job&quot; state=absent&#39;  #移除任务
user    用户账号管理
   name    用户名
   uid     uid
   state   状态  
   group   属于哪个组
   groups  附加组
   home    家目录
   createhome  是否创建家目录
   comment 注释信息
   system  是否是系统用户
   
   # ansible all -m user -a &#39;name=&quot;user1&quot;&#39;
   # ansible all -m user -a &#39;name=&quot;user1&quot; state=absent&#39;
group   组管理
   gid     gid      
   name    组名               
   state   状态           
   system  是否是系统组
   # ansible webserver -m group -a &#39;name=mysql gid=306 system=yes&#39;
   # ansible webserver -m user -a &#39;name=mysql uid=306 system=yes group=mysql&#39;
copy    复制文件(复制本地文件到远程主机的指定位置)
   src     定义本地源文件路径
   dest    定义远程目录文件路径(绝对路径)
   owner   属主
   group   属组
   mode    权限
   content 取代src=,表示直接用此处的信息生成为文件内容
   # yum -y install libselinux-python
   # ansible all -m copy -a &#39;src=/etc/fstab dest=/tmp/fstab.ansible owner=root mode=640&#39;
   # ansible all -m copy -a &#39;content=&quot;hello ansible
Hi ansible&quot; dest=/tmp/test.ansible&#39;
file    设置文件的属性
   path|dest|name  对那个文件做设定
   
   创建文件的符号链接：
       src：    指定源文件
       path：   指明符号链接文件路径
   # ansible all -m file -a &#39;owner=mysql group=mysql mode=644 path=/tmp/fstab.ansible&#39;
   # ansible all -m file -a &#39;path=/tmp/fstab.link src=/tmp/fstab.ansible state=link&#39;
ping    测试指定主机是否能连接
   # ansible all -m ping
service 管理服务运行状态
   enabled 是否开机自动启动
   name    指定服务名
   state   指定服务状态
       started     启动服务
       stoped      停止服务
       restarted   重启服务
   arguments   服务的参数
   # ansible webserver -m service -a &#39;enabled=true name=httpd state=started&#39;
shell   在远程主机上运行命令
   尤其是用到管道变量等功能的复杂命令
   # ansible all -m shell -a &#39;echo devopsman | passwd --stdin user1&#39;
script  将本地脚本复制到远程主机并运行之
   # ansible all -m script -a &#39;/tmp/test.sh&#39;
yum     安装程序包
   name    程序包名称(不指定版本就安装最新的版本latest)
   state   present,latest表示安装，absent表示卸载
   # ansible webserver -m yum -a &#39;name=httpd&#39;
   # ansible all -m yum -a &#39;name=ntpdate&#39;  #默认就是安装
   # ansible all -m yum -a &#39;name=ntpdate state=absent&#39;
setup   收集远程主机的facts
   每个被管理节点在接受并运行管理命令之前，会将自己主机相关信息，如操作系统版本，IP地址等报告给远程的ansible主机 
   # ansible all -m setup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3三、ansible-playbook" tabindex="-1"><a class="header-anchor" href="#_3三、ansible-playbook" aria-hidden="true">#</a> 3<strong>三、Ansible playbook</strong></h2><p>组成结构：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>inventory       #以下操作应用的主机
modules         #调用哪些模块做什么样的操作
ad hoc commands #在这些主机上运行哪些命令
playbooks   
   tasks       #任务,即调用模块完成的某操作
   variable    #变量
   templates   #模板
   handlers    #处理器，由某事件触发执行的操作
   roles       #角色
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4四、yaml" tabindex="-1"><a class="header-anchor" href="#_4四、yaml" aria-hidden="true">#</a> 4<strong>四、YAML</strong></h2><h3 id="_4-1-yaml介绍" tabindex="-1"><a class="header-anchor" href="#_4-1-yaml介绍" aria-hidden="true">#</a> 4.1 YAML介绍</h3><p>YAML是一个可读性高的用来表达资料序列的格式。YAML参考了其它多种语言，包括：XML、C语言、Python、Perl以及电子邮件格式RFC2822等。ClarkEvans在2001年首次发表了这种语言，另外Ingy dot Net与Oren Ben-Kiki也是这语言的共同设计者。</p><p>YAML Ain&#39;t Markup Language,即YAML不是XML，不过，在开发这种语言时，YAML的意思其实是：&quot;Yet Another Markup Language&quot;(仍是一种标记语言)，其特性：</p><ul><li>YAML的可读性好</li><li>YAML和脚本语言的交互性好</li><li>YAML使用实现语言的数据类型</li><li>YAML有一个一致的信息模型</li><li>YAML易于实现</li><li>YAML可以基于流来处理</li><li>YAML表达能力强，扩展性好</li></ul><blockquote><p>更多的<strong>内容及规范参见</strong>[1]</p></blockquote><h3 id="_4-2-yaml语法" tabindex="-1"><a class="header-anchor" href="#_4-2-yaml语法" aria-hidden="true">#</a> 4.2 YAML语法</h3><p>YAML的语法和其他高阶语言类似，并且可以简单表达清单、散列表、标量等数据结构，其结构(structure)通过空格来展示，序列(sequence)里的项用&quot;-&quot;来表示，Map里面的键值对用&quot;:&quot;分割，下面是一个示例。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>name: john smith
age: 41
gender: male
spouse:
   name:jane smith
   age:37
   gender: female
children:
   -   name:jimmy smith
       age:17
       gender: male
   -   name:jenny smith
       age: 13
       gender: female
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>YAML文件扩展名通常为.yaml，如example.yaml</p><p><a href="http://mp.weixin.qq.com/s?__biz=MzAwNTM5Njk3Mw==&amp;mid=2247506725&amp;idx=2&amp;sn=cb0395b93925ce3a06edf60d7ca7d2c1&amp;chksm=9b1fdba7ac6852b182a5907c301fc9df85497315989ee99c4fbc2a88fad84a6032783b3524b0&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">Docker+K8s+Jenkins 主流技术全解视频资料<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="_4-2-1-list" tabindex="-1"><a class="header-anchor" href="#_4-2-1-list" aria-hidden="true">#</a> 4.2.1 list</h3><p>列表的所有元素均使用&quot;-&quot;打头，例如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># A list of testy fruits
- Apple
- Orange
- Strawberry
- Mango
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-2-dictionary" tabindex="-1"><a class="header-anchor" href="#_4-2-2-dictionary" aria-hidden="true">#</a> 4.2.2 dictionary</h3><p>字典通过key与value进行标识，例如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>---
# An employee record
name: Example Developer
job: Developer
skill: Elite
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以将key:value放置于{}中进行表示，例如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>---
#An exmloyee record
{name: Example Developer, job: Developer, skill: Elite}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5五、ansible基础元素" tabindex="-1"><a class="header-anchor" href="#_5五、ansible基础元素" aria-hidden="true">#</a> 5<strong>五、Ansible基础元素</strong></h2><h3 id="_5-1-变量" tabindex="-1"><a class="header-anchor" href="#_5-1-变量" aria-hidden="true">#</a> 5.1 变量</h3><h4 id="_5-1-1-变量命名" tabindex="-1"><a class="header-anchor" href="#_5-1-1-变量命名" aria-hidden="true">#</a> 5.1.1 变量命名</h4><p>变量名仅能由字母、数字和下划线组成，且只能以字母开头。</p><h4 id="_5-1-2-facts" tabindex="-1"><a class="header-anchor" href="#_5-1-2-facts" aria-hidden="true">#</a> 5.1.2 facts</h4><p>facts是由正在通信的远程目标主机发回的信息，这些信息被保存在ansible变量中。要获取指定的远程主机所支持的所有facts，可使用如下命令进行：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>#ansible hostname -m setup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_5-1-3-register" tabindex="-1"><a class="header-anchor" href="#_5-1-3-register" aria-hidden="true">#</a> 5.1.3 register</h4><p>把任务的输出定义为变量，然后用于其他任务，实例如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tasks:
   - shell: /usr/bin/foo
     register: foo_result
     ignore_errors: True
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-1-4-通过命令行传递变量" tabindex="-1"><a class="header-anchor" href="#_5-1-4-通过命令行传递变量" aria-hidden="true">#</a> 5.1.4 通过命令行传递变量</h4><p>在运行playbook的时候也可以传递一些变量供playbook使用，示例如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>#ansible-playbook test.yml --extra-vars &quot;hosts=www user=devopsman&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_5-1-5-通过roles传递变量" tabindex="-1"><a class="header-anchor" href="#_5-1-5-通过roles传递变量" aria-hidden="true">#</a> 5.1.5 通过roles传递变量</h4><p>当给一个主机应用角色的时候可以传递变量，然后在角色内使用这些变量，示例如下：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>- hosts: webserver
 roles:
   - common
   - {role: foo_app_instance, dir: &#39;/web/htdocs/a.com&#39;, port: 8080}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-inventory" tabindex="-1"><a class="header-anchor" href="#_5-2-inventory" aria-hidden="true">#</a> 5.2 Inventory</h3><p>ansible的主要功用在于批量主机操作，为了便捷的使用其中的部分主机，可以在inventory file中将其分组命名，默认的inventory file为/etc/ansible/hosts</p><p>inventory file可以有多个，且也可以通过Dynamic Inventory来动态生成。</p><h4 id="_5-2-1-inventory文件格式" tabindex="-1"><a class="header-anchor" href="#_5-2-1-inventory文件格式" aria-hidden="true">#</a> 5.2.1 inventory文件格式</h4><p>inventory文件遵循INI文件风格，中括号中的字符为组名。可以将同一个主机同时归并到多个不同的组中；此外，当如若目标主机使用非默认的SSH端口，还可以在主机名称之后使用冒号加端口号来表明。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ntp.devopsman.cn

[webserver]
www1.devopsman.cn:2222
www2.devopsman.cn

[dbserver]
db1.devopsman.cn
db2.devopsman.cn
db3.devopsman.cn

如果主机名遵循相似的命名模式，还可使用列表的方式标识个主机，例如：
[webserver]
www[01:50].example.com

[databases]
db-[a:f].example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-2-主机变量" tabindex="-1"><a class="header-anchor" href="#_5-2-2-主机变量" aria-hidden="true">#</a> 5.2.2 主机变量</h4><p>可以在inventory中定义主机时为其添加主机变量以便于在playbook中使用，例如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[webserver]
www1.devopsman.cn http_port=80 maxRequestsPerChild=808
www2.devopsman.cn http_port=8080 maxRequestsPerChild=909
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-3-组变量" tabindex="-1"><a class="header-anchor" href="#_5-2-3-组变量" aria-hidden="true">#</a> 5.2.3 组变量</h4><p>组变量是指赋予给指定组内所有主机上的在playbook中可用的变量。例如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[webserver]
www1.devopsman.cn
www2.devopsman.cn

[webserver:vars]
ntp_server=ntp.devopsman.cn
nfs_server=nfs.devopsman.cn
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>5.2.4 组嵌套</p><p>inventory中，组还可以包含其它的组，并且也可以向组中的主机指定变量。不过，这些变量只能在ansible-playbook中使用，而ansible不支持。例如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[apache]
httpd1.devopsman.cn
httpd2.devopsman.cn

[nginx]
ngx1.devopsman.cn
ngx2.devopsman.cn

[webserver:children]    #固定格式
apache
nginx

[webserver:vars]
ntp_server=ntp.devopsman.cn
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-5-inventory参数" tabindex="-1"><a class="header-anchor" href="#_5-2-5-inventory参数" aria-hidden="true">#</a> 5.2.5 inventory参数</h4><p>ansible基于ssh连接inventory中指定的远程主机时，还可以通过参数指定其交互方式，这些参数如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ansible_ssh_host
ansible_ssh_port
ansible_ssh_user
ansible_ssh_pass
ansible_sudo_pass
ansible_connection
ansible_ssh_private_key_file
ansible_shell_type
ansible_python_interpreter
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-条件测试" tabindex="-1"><a class="header-anchor" href="#_5-3-条件测试" aria-hidden="true">#</a> 5.3 条件测试</h3><p>如果需要根据变量、facts或此前任务的执行结果来做为某task执行与否的前提时要用到条件测试。</p><h4 id="_5-3-1-when语句" tabindex="-1"><a class="header-anchor" href="#_5-3-1-when语句" aria-hidden="true">#</a> 5.3.1 when语句</h4><p>在task后添加when字句即可使用条件测试；when语句支持jinja2表达式语句，例如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tasks:
 - name: &#39;shutdown debian flavored system&quot;
   command: /sbin/shutdown -h now
   when: ansible_os_family == &quot;Debian&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>when语句中还可以使用jinja2的大多&quot;filter&quot;,例如果忽略此前某语句的错误并基于其结果(failed或success)运行后面指定的语句，可使用类似如下形式；</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tasks:
 - command:/bin/false
   register: result
   ignore_errors: True
 - command: /bin/something
   when: result|failed
 - command: /bin/something_else
   when: result|success
 - command: /bin/still/something_else
   when: result|skipped
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此外，when语句中还可以使用facts或playbook中定义的变量</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># cat cond.yml 
- hosts: all
 remote_user: root
 vars:
 - username: user10
 tasks:
 - name: create {{ username }} user
   user: name={{ username }} 
   when: ansible_fqdn == &quot;node1.exercise.com&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-迭代" tabindex="-1"><a class="header-anchor" href="#_5-4-迭代" aria-hidden="true">#</a> 5.4 迭代</h3><p>当有需要重复性执行的任务时，可以使用迭代机制。其使用格式为将需要迭代的内容定义为item变量引用，并通过with_items语句来指明迭代的元素列表即可。例如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>- name: add server user
 user: name={{ item }} state=persent groups=wheel
 with_items:
   - testuser1
   - testuser2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面语句的功能等同于下面的语句：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>- name: add user testuser1
 user: name=testuser1 state=present group=wheel
- name: add user testuser2
 user: name=testuser2 state=present group=wheel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>事实上，with_items中可以使用元素还可为hashes，例如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>- name: add several users
 user: name={{ item.name}} state=present groups={{ item.groups }}
 with_items:
   - { name: &#39;testuser1&#39;, groups: &#39;wheel&#39;}
   - { name: &#39;testuser2&#39;, groups: &#39;root&#39;}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Ansible的循环机制还有更多的高级功能，具体请参考<strong>官方文档</strong>[2]</p></blockquote><h2 id="_6六、模板示例" tabindex="-1"><a class="header-anchor" href="#_6六、模板示例" aria-hidden="true">#</a> 6<strong>六、模板示例：</strong></h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># grep &#39;{{&#39; conf/httpd.conf 
MaxClients       {{ maxClients }}
Listen {{ httpd_port }}

# cat /etc/ansible/hosts
[webserver]
127.0.0.1 httpd_port=80 maxClients=100
192.168.10.149 httpd_port=8080 maxClients=200

# cat apache.yml 
- hosts: webserver
 remote_user: root
 vars:
 - package: httpd
 - service: httpd
 tasks:
 - name: install httpd package
   yum: name={{ package }} state=latest
 - name: install configuration file for httpd
   template: src=/root/conf/httpd.conf dest=/etc/httpd/conf/httpd.conf
   notify: 
   - restart httpd
 - name: start httpd service
   service: enabled=true name={{ service }} state=started
 
 handlers:
 - name: restart httpd
   service: name=httpd state=restarted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7七、ansible-playbooks" tabindex="-1"><a class="header-anchor" href="#_7七、ansible-playbooks" aria-hidden="true">#</a> 7<strong>七、Ansible playbooks</strong></h2><p>playbook是由一个或多个&quot;play&quot;组成的列表。play的主要功能在于将事先归并为一组的主机装扮成事先通过ansible中的task定义好的角色。从根本上来讲，所有task无非是调用ansible的一个module。将多个play组织在一个playbook中，即可以让他们连同起来按事先编排的机制同唱一台大戏。下面是一个简单示例。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>- hosts: webserver
 vars:
   http_port: 80
   max_clients: 256
 remote_user: root
 tasks:
 - name: ensure apache is at the latest version
   yum: name=httpd state=latest
 - name: ensure apache is running
   service: name=httpd state=started
 handlers:
   - name: restart apache
     service: name=httpd state=restarted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-1-playbook基础组件" tabindex="-1"><a class="header-anchor" href="#_7-1-playbook基础组件" aria-hidden="true">#</a> 7.1 playbook基础组件</h3><h4 id="_7-1-1-hosts和users" tabindex="-1"><a class="header-anchor" href="#_7-1-1-hosts和users" aria-hidden="true">#</a> 7.1.1 Hosts和Users</h4><p>playbook中的每一个play的目的都是为了让某个或某些主机以某个指定的用户身份执行任务。hosts用于指定要执行指定任务的主机，其可以使一个或多个由冒号分隔主机组；remote_user则用于指定远程主机的执行任务的用户，如上面的实例中的</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>- hosts: webserver
 remote_user: root
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>不过，remote_user也可用于各task中，也可以通过指定其通过sudo的方式在远程主机上执行任务，其可用于play全局或其任务；此外，甚至可以在sudo时使用sudo_user指定sudo时切换的用户。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>- hosts: webserver
 remote_user: devopsman
 tasks:
  - name: test connection
    ping:
    remote_user: devopsman
    sudo: yes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-1-2-任务列表和action" tabindex="-1"><a class="header-anchor" href="#_7-1-2-任务列表和action" aria-hidden="true">#</a> 7.1.2 任务列表和action</h4><p>play的主题部分是task list。task list中的各任务按次序逐个在hosts中指定的所有主机上执行，即在所有主机上完成第一个任务后再开始第二个。在运行自上而下某playbook时，如果中途发生错误，所有已执行任务都可能回滚，在更正playbook后重新执行一次即可。</p><p>taks的目的是使用指定的参数执行模块，而在模块参数中可以使用变量。模块执行是幂等的。这意味着多次执行是安全的，因为其结果均一致。</p><p>每个task都应该有其name，用于playbook的执行结果输出，建议其内容尽可能清晰地描述任务执行步骤，如果为提供name，则action的结果将用于输出。</p><p>定义task可以使用&quot;action: module options&quot;或”module：options“的格式推荐使用后者以实现向后兼容。如果action一行的内容过多，也中使用在行首使用几个空白字符进行换行。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tasks:
 - name:make sure apache is running
   service: name=httpd state=started
tasks:
 - name: run this command and ignore the result
   shell: /usr/bin/somecommand || /bin/true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在众多的模块中，只有command和shell模块仅需要给定一个列表而无需使用&quot;key=value&quot;格式，例如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tasks:
 - name: disable selinux
   command: /sbin/setenforce 0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果命令或脚本的退出码不为零，可以使用如下方式替代：</p><p>或者使用ignore_errors来忽略错误信息：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>tasks:
 - name: run this command and ignore the result
   shell: /usr/bin/somecommand
   ignore_errors: True
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-1-3handlers" tabindex="-1"><a class="header-anchor" href="#_7-1-3handlers" aria-hidden="true">#</a> 7.1.3handlers</h4><p>用于当关注的资源发生变化时采取一定的操作。</p><p>&quot;notify&quot;这个action可用于在每个play的最后被触发，这样可以避免多次有改变发生时每次都执行执行的操作，取而代之，仅在所有的变化发生完成后一次性地执行指定操作，在notify中列出的操作称为handlers，也即notify中调用handlers中定义的操作。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>- name: template configuration file
 template: src=template.j2 dest=/etc/foo.conf
 notify:
   - restart memcached
   - restart apache
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>handlers是task列表，这些task与前述的task并没有本质上的不同。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>handlers：
 - name: restart memcached
   service: name=memcached state=restarted
 - name: restart apache
   service: name=apache state=restarted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="简单示例1" tabindex="-1"><a class="header-anchor" href="#简单示例1" aria-hidden="true">#</a> 简单示例1：</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># cat nginx.yml 
- hosts: webserver
 remote_user: root
 tasks:
 - name: create nginxn group
   group: name=nginx system=yes gid=208
 - name: create nginx user
   user: name=nginx uid=208 group=nginx system=yes

- hosts: dbserver
 remote_user: root
 tasks:
 - name: copy file to dbserver
   copy: src=/etc/inittab dest=/tmp/inittab.ans
   
# ansible-playbook nginx.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="简单示例2" tabindex="-1"><a class="header-anchor" href="#简单示例2" aria-hidden="true">#</a> 简单示例2：</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># cat apache.yml 
- hosts: webserver
 remote_user: root
 tasks:
 - name: install httpd package
   yum: name=httpd state=latest
 - name: install configuration file for httpd
   copy: src=/root/conf/httpd.conf dest=/etc/httpd/conf/httpd.conf
 - name: start httpd service
   service: enabled=true name=httpd state=started

# ansible-playbook apache.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="handlers-示例" tabindex="-1"><a class="header-anchor" href="#handlers-示例" aria-hidden="true">#</a> handlers 示例：</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># cat apache.yml 
- hosts: webserver
 remote_user: root
 tasks:
 - name: install httpd package
   yum: name=httpd state=latest
 - name: install configuration file for httpd
   copy: src=/root/conf/httpd.conf dest=/etc/httpd/conf/httpd.conf
   notify: 
   - restart httpd
 - name: start httpd service
   service: enabled=true name=httpd state=started
 
 handlers:
 - name: restart httpd
   service: name=httpd state=restarted

#  ansible-playbook apache.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="variable-示例1" tabindex="-1"><a class="header-anchor" href="#variable-示例1" aria-hidden="true">#</a> variable 示例1：</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># cat apache.yml 
- hosts: webserver
 remote_user: root
 vars:
 - package: httpd
 - service: httpd
 tasks:
 - name: install httpd package
   yum: name={{ package }} state=latest
 - name: install configuration file for httpd
   copy: src=/root/conf/httpd.conf dest=/etc/httpd/conf/httpd.conf
   notify: 
   - restart httpd
 - name: start httpd service
   service: enabled=true name={{ service }} state=started
 
 handlers:
 - name: restart httpd
   service: name=httpd state=restarted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="variable-示例2-在playbook中可以使用所有的变量" tabindex="-1"><a class="header-anchor" href="#variable-示例2-在playbook中可以使用所有的变量" aria-hidden="true">#</a> variable 示例2：(在playbook中可以使用所有的变量)</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># cat facts.yml 
- hosts: webserver
 remote_user: root
 tasks:
 - name: copy file
   copy: content=&quot;{{ ansible_all_ipv4_addresses }} &quot; dest=/tmp/vars.ans
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8八、roles" tabindex="-1"><a class="header-anchor" href="#_8八、roles" aria-hidden="true">#</a> 8<strong>八、roles</strong></h2><p>ansible自1.2版本引入的新特性，用于层次性、结构化地组织playbook。roles能够根据层次型结构自动转载变量文件、tasks以及handlers等。要使用roles只需要在playbook中使用include指令即可。简单来讲，roles就是通过分别将变量、文件、任务、模板以及处理器放置于单独的目录中，并可以便捷地include他们的一种机制。角色一般用于基于主机构建服务的场景中，但也可以使用于构建守护进程的场景中</p><p><a href="http://mp.weixin.qq.com/s?__biz=MzAwNTM5Njk3Mw==&amp;mid=2247506725&amp;idx=2&amp;sn=cb0395b93925ce3a06edf60d7ca7d2c1&amp;chksm=9b1fdba7ac6852b182a5907c301fc9df85497315989ee99c4fbc2a88fad84a6032783b3524b0&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">Docker+K8s+Jenkins 主流技术全解视频资料<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>一个roles的案例如下所示：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>site.yml
webserver.yml
fooserver.yml
roles/
   common/
       files/
       templates/
       tasks/
       handlers/
       vars/
       meta/
   webserver/
       files/
       templates/
       tasks/
       handlers/
       vars/
       meta/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而在playbook中，可以这样使用role：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>- hosts: webserver
 roles:
   - common  
   - webserver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以向roles传递参数，例如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>- hosts: webserver
 roles:
   - common
   - { role: foo_app_instance, dir:&#39;/opt/a&#39;,port:5000}
   - { role: foo_app_instance, dir:&#39;/opt/b&#39;,port:5001}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>甚至也可以条件式地使用roles，例如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>- hosts：webserver
 roles:
   - { role: some_role, when: &quot;ansible_so_family == &#39;RedHat&quot; }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-1-创建role的步骤" tabindex="-1"><a class="header-anchor" href="#_8-1-创建role的步骤" aria-hidden="true">#</a> 8.1 创建role的步骤</h3><ol><li>创建以roles命名的目录：</li><li>在roles目录中分别创建以各角色命名的目录，如webserver等</li><li>在每个角色命名的目录中分别创建files、handlers、meta、tasks、templates和vars目录；用不到的目录可以创建为空目录，也可以不创建</li><li>在playbook文件中，调用各角色</li></ol><h3 id="_8-2-role内各目录中可应用的文件" tabindex="-1"><a class="header-anchor" href="#_8-2-role内各目录中可应用的文件" aria-hidden="true">#</a> 8.2 role内各目录中可应用的文件</h3><ul><li>task目录：至少应该包含一个为main.yml的文件，其定义了此角色的任务列表；此文件可以使用include包含其它的位于此目录中的task文件；</li><li>file目录：存放由copy或script等模板块调用的文件；</li><li>template目录：template模块会自动在此目录中寻找jinja2模板文件；</li><li>handlers目录：此目录中应当包含一个main.yml文件，用于定义此角色用到的各handlers，在handler中使用inclnude包含的其它的handlers文件也应该位于此目录中；</li><li>vars目录：应当包含一个main.yml文件，用于定义此角色用到的变量</li><li>meta目录：应当包含一个main.yml文件，用于定义此角色的特殊设定及其依赖关系；ansible1.3及其以后的版本才支持；</li><li>default目录：应当包含一个main.yml文件,用于为当前角色设定默认变量时使用此目录；</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># mkdir -pv ansible_playbooks/roles/{webserver,dbserver}/{tasks,files,templates,meta,handlers,vars} 
# cp /etc/httpd/conf/httpd.conf files/  
# pwd
/root/ansible_playbooks/roles/webserver 
# cat tasks/main.yml 
- name: install httpd package
 yum: name=httpd state=present
- name: install configuretion file
 copy: src=httpd.conf dest=/etc/httpd/conf/httpd.conf
 tags:
 - conf
 notify:
 - restart httpd
- name: start httpd
 service: name=httpd state=started

# cat handlers/main.yml 
- name: restart httpd
 service: name=httpd state=restarted
   
# pwd;ls
/root/ansible_playbooks
roles  site.yml 


# cat site.yml 
- hosts: webserver
 remote_user: root
 roles:
 - webserver

# ansible-playbook site.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9九、tags" tabindex="-1"><a class="header-anchor" href="#_9九、tags" aria-hidden="true">#</a> 9<strong>九、Tags</strong></h2><p>tags用于让用户选择运行或跳过playbook中的部分代码。ansible具有幂等性，因此会自动跳过没有变化的部分，即便如此，有些代码为测试其确实没有发生变化的时间依然会非常的长。此时，如果确信其没有变化，就可以通过tags跳过此些代码片段。</p><p>tags：在playbook可以为某个或某些任务定义一个&quot;标签&quot;，在执行此playbook时，通过为ansible-playbook命令使用--tags选项能耐实现仅运行指定的tasks而非所有的；</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># cat apache.yml 
- hosts: webserver
 remote_user: root
 vars:
 - package: httpd
 - service: httpd
 tasks:
 - name: install httpd package
   yum: name={{ package }} state=latest
 - name: install configuration file for httpd
   template: src=/root/conf/httpd.conf dest=/etc/httpd/conf/httpd.conf
   tags:
   - conf
   notify: 
   - restart httpd
 - name: start httpd service
   service: enabled=true name={{ service }} state=started
 
 handlers:
 - name: restart httpd
   service: name=httpd state=restarted

# ansible-playbook apache.yml --tags=&#39;conf&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>特殊tags：always #无论如何都会运行</p></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/6/5 03:56:58</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: shijinguosjg@gmail.com">00D2</span><!--]--><!--]--></div></footer><!----><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.78d595fb.js" defer></script>
  </body>
</html>
